<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPS ç‚¹å‡»é€Ÿåº¦æµ‹è¯•å™¨</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            font-family: 'Orbitron', monospace;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .neon-glow {
            text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff, 0 0 15px #00ffff, 0 0 20px #00ffff;
        }
        
        .cyber-border {
            border: 2px solid;
            border-image: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00, #00ffff) 1;
            box-shadow: 
                0 0 20px rgba(0, 255, 255, 0.5),
                inset 0 0 20px rgba(255, 0, 255, 0.1);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(0, 255, 255, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 30px rgba(0, 255, 255, 0.8); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(0, 255, 255, 0.5); }
        }
        
        .data-display {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .history-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }
        
        .history-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: #00ffff;
            transform: translateX(5px);
        }
        
        .history-item.latest {
            border-left-color: #ffff00;
            background: rgba(255, 255, 0, 0.1);
        }
        
        .countdown-circle {
            background: conic-gradient(from 0deg, #00ffff, #ff00ff, #ffff00, #00ffff);
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .level-badge {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            font-weight: 900;
        }
        
        .click-ripple {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 255, 255, 0.6) 0%, transparent 70%);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00ffff;
            border-radius: 50%;
            animation: float 6s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        .glow-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px 0 rgba(116, 75, 162, 0.75);
            transition: all 0.3s ease;
        }
        
        .glow-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(116, 75, 162, 0.9);
        }
        
        .stats-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ç­‰çº§è¯„ä»·ç³»ç»Ÿ
        const getLevelInfo = (cps) => {
            if (cps < 4) return { name: 'æ–°æ‰‹', color: '#999999', icon: 'ğŸŒ±' };
            if (cps < 6) return { name: 'æ™®é€š', color: '#4CAF50', icon: 'ğŸ‘' };
            if (cps < 8) return { name: 'ç†Ÿç»ƒ', color: '#2196F3', icon: 'ğŸ’ª' };
            if (cps < 10) return { name: 'é«˜æ‰‹', color: '#FF9800', icon: 'ğŸ”¥' };
            if (cps < 12) return { name: 'ä¸“ä¸š', color: '#E91E63', icon: 'âš¡' };
            return { name: 'è¶…ç¥', color: '#9C27B0', icon: 'ğŸ‘‘' };
        };

        // æµ®åŠ¨ç²’å­ç»„ä»¶
        const FloatingParticles = () => {
            const particles = Array.from({ length: 20 }, (_, i) => (
                <div
                    key={i}
                    className="particle"
                    style={{
                        left: `${Math.random() * 100}%`,
                        animationDelay: `${Math.random() * 6}s`,
                        animationDuration: `${4 + Math.random() * 4}s`
                    }}
                />
            ));

            return <div className="floating-particles">{particles}</div>;
        };

        // ç‚¹å‡»æ¶Ÿæ¼ªæ•ˆæœç»„ä»¶
        const ClickRipple = ({ x, y, id, onComplete }) => {
            useEffect(() => {
                const timer = setTimeout(() => {
                    onComplete(id);
                }, 600);
                return () => clearTimeout(timer);
            }, [id, onComplete]);

            return (
                <div
                    className="click-ripple"
                    style={{
                        left: x - 50,
                        top: y - 50,
                        width: 100,
                        height: 100
                    }}
                />
            );
        };

        // ä¸»è¦CPSæµ‹è¯•å™¨ç»„ä»¶
        const CPSTester = () => {
            // çŠ¶æ€ç®¡ç†
            const [gameState, setGameState] = useState('idle'); // idle, testing, finished, cooldown
            const [duration, setDuration] = useState(10);
            const [timeLeft, setTimeLeft] = useState(0);
            const [clickCount, setClickCount] = useState(0);
            const [currentCPS, setCurrentCPS] = useState(0);
            const [finalCPS, setFinalCPS] = useState(0);
            const [bestCPS, setBestCPS] = useState(0);
            const [history, setHistory] = useState([]);
            const [cooldownTime, setCooldownTime] = useState(0);
            const [ripples, setRipples] = useState([]);

            // å¼•ç”¨
            const startTimeRef = useRef(0);
            const intervalRef = useRef(null);
            const cooldownRef = useRef(null);
            const rippleIdRef = useRef(0);

            // ä»localStorageåŠ è½½å†å²è®°å½•
            useEffect(() => {
                const savedHistory = localStorage.getItem('cps-history');
                const savedBest = localStorage.getItem('cps-best');
                
                if (savedHistory) {
                    setHistory(JSON.parse(savedHistory));
                }
                if (savedBest) {
                    setBestCPS(parseFloat(savedBest));
                }
            }, []);

            // ä¿å­˜å†å²è®°å½•åˆ°localStorage
            const saveToStorage = (newHistory, newBest) => {
                localStorage.setItem('cps-history', JSON.stringify(newHistory));
                if (newBest > bestCPS) {
                    localStorage.setItem('cps-best', newBest.toString());
                }
            };

            // æ·»åŠ ç‚¹å‡»æ¶Ÿæ¼ªæ•ˆæœ
            const addRipple = (event) => {
                const rect = document.body.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                const id = rippleIdRef.current++;
                
                setRipples(prev => [...prev, { id, x, y }]);
            };

            // ç§»é™¤æ¶Ÿæ¼ªæ•ˆæœ
            const removeRipple = (id) => {
                setRipples(prev => prev.filter(ripple => ripple.id !== id));
            };

            // å¼€å§‹æµ‹è¯•
            const startTest = () => {
                if (gameState !== 'idle') return;
                
                setGameState('testing');
                setTimeLeft(duration);
                setClickCount(0);
                setCurrentCPS(0);
                startTimeRef.current = Date.now();

                // å€’è®¡æ—¶
                intervalRef.current = setInterval(() => {
                    const elapsed = (Date.now() - startTimeRef.current) / 1000;
                    const remaining = Math.max(0, duration - elapsed);
                    
                    setTimeLeft(remaining);
                    
                    if (remaining <= 0) {
                        endTest();
                    }
                }, 16); // 60fpsæ›´æ–°
            };

            // ç»“æŸæµ‹è¯•
            const endTest = () => {
                if (intervalRef.current) {
                    clearInterval(intervalRef.current);
                    intervalRef.current = null;
                }

                const actualDuration = (Date.now() - startTimeRef.current) / 1000;
                const finalCPSValue = clickCount / actualDuration;
                
                setFinalCPS(finalCPSValue);
                setCurrentCPS(finalCPSValue);
                setGameState('finished');

                // æ·»åŠ åˆ°å†å²è®°å½•
                const newRecord = {
                    timestamp: Date.now(),
                    duration: duration,
                    clicks: clickCount,
                    cps: finalCPSValue,
                    level: getLevelInfo(finalCPSValue).name
                };

                const newHistory = [newRecord, ...history].slice(0, 20); // åªä¿ç•™æœ€è¿‘20æ¡
                setHistory(newHistory);

                // æ›´æ–°æœ€ä½³æˆç»©
                const newBest = Math.max(bestCPS, finalCPSValue);
                setBestCPS(newBest);

                // ä¿å­˜åˆ°localStorage
                saveToStorage(newHistory, newBest);

                // å¼€å§‹å†·å´æ—¶é—´
                setCooldownTime(5);
                cooldownRef.current = setInterval(() => {
                    setCooldownTime(prev => {
                        if (prev <= 1) {
                            clearInterval(cooldownRef.current);
                            setGameState('idle');
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
            };

            // å¤„ç†ç‚¹å‡»
            const handleClick = (event) => {
                if (gameState === 'testing') {
                    setClickCount(prev => {
                        const newCount = prev + 1;
                        const elapsed = (Date.now() - startTimeRef.current) / 1000;
                        const newCPS = newCount / elapsed;
                        setCurrentCPS(newCPS);
                        return newCount;
                    });
                    addRipple(event);
                }
            };

            // é”®ç›˜äº‹ä»¶å¤„ç†
            useEffect(() => {
                const handleKeyPress = (event) => {
                    if (event.code === 'Space') {
                        event.preventDefault();
                        
                        if (gameState === 'idle') {
                            startTest();
                        } else if (gameState === 'testing') {
                            // åˆ›å»ºæ¨¡æ‹Ÿé¼ æ ‡äº‹ä»¶ç”¨äºæ¶Ÿæ¼ªæ•ˆæœ
                            const fakeEvent = {
                                clientX: window.innerWidth / 2 + (Math.random() - 0.5) * 200,
                                clientY: window.innerHeight / 2 + (Math.random() - 0.5) * 200
                            };
                            handleClick(fakeEvent);
                        }
                    }

                    // æ•°å­—é”®é€‰æ‹©æ—¶é•¿
                    if (gameState === 'idle') {
                        if (event.key === '1') setDuration(5);
                        if (event.key === '2') setDuration(10);
                        if (event.key === '3') setDuration(20);
                        if (event.key === '4') setDuration(30);
                    }
                };

                window.addEventListener('keydown', handleKeyPress);
                return () => window.removeEventListener('keydown', handleKeyPress);
            }, [gameState, duration]);

            // æ¸…ç†å®šæ—¶å™¨
            useEffect(() => {
                return () => {
                    if (intervalRef.current) clearInterval(intervalRef.current);
                    if (cooldownRef.current) clearInterval(cooldownRef.current);
                };
            }, []);

            // è·å–çŠ¶æ€æ–‡æœ¬
            const getStatusText = () => {
                switch (gameState) {
                    case 'idle':
                        return 'æŒ‰ç©ºæ ¼é”®å¼€å§‹æµ‹è¯•';
                    case 'testing':
                        return 'ç–¯ç‹‚æŒ‰ç©ºæ ¼é”®ï¼';
                    case 'finished':
                        return 'æµ‹è¯•å®Œæˆï¼';
                    case 'cooldown':
                        return `å†·å´ä¸­... ${cooldownTime}s`;
                    default:
                        return '';
                }
            };

            const levelInfo = getLevelInfo(gameState === 'finished' ? finalCPS : currentCPS);

            return (
                <div className="gradient-bg min-h-screen relative overflow-hidden">
                    <FloatingParticles />
                    
                    {/* æ¶Ÿæ¼ªæ•ˆæœ */}
                    {ripples.map(ripple => (
                        <ClickRipple
                            key={ripple.id}
                            x={ripple.x}
                            y={ripple.y}
                            id={ripple.id}
                            onComplete={removeRipple}
                        />
                    ))}

                    <div className="container mx-auto px-4 py-8 h-screen flex flex-col">
                        {/* æ ‡é¢˜ */}
                        <div className="text-center mb-8">
                            <h1 className="text-6xl font-black text-white neon-glow mb-4">
                                CPS æµ‹è¯•å™¨
                            </h1>
                            <p className="text-xl text-cyan-300">
                                Clicks Per Second - ç‚¹å‡»é€Ÿåº¦æŒ‘æˆ˜
                            </p>
                        </div>

                        <div className="flex-1 flex gap-8">
                            {/* ä¸»æµ‹è¯•åŒºåŸŸ */}
                            <div className="flex-1 flex flex-col">
                                {/* æ—¶é•¿é€‰æ‹© */}
                                <div className="data-display rounded-2xl p-6 mb-6">
                                    <h3 className="text-white text-xl mb-4 text-center">
                                        æµ‹è¯•æ—¶é•¿ (æŒ‰æ•°å­—é”® 1-4 å¿«é€Ÿé€‰æ‹©)
                                    </h3>
                                    <div className="flex gap-4 justify-center">
                                        {[5, 10, 20, 30].map((time, index) => (
                                            <button
                                                key={time}
                                                className={`px-6 py-3 rounded-lg font-bold transition-all duration-300 ${
                                                    duration === time
                                                        ? 'cyber-border text-cyan-300 pulse-animation'
                                                        : 'glow-button text-white hover:scale-105'
                                                } ${gameState !== 'idle' ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                onClick={() => gameState === 'idle' && setDuration(time)}
                                                disabled={gameState !== 'idle'}
                                            >
                                                {index + 1}. {time}s
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* ä¸»æ˜¾ç¤ºåŒºåŸŸ */}
                                <div className="data-display rounded-3xl p-8 mb-6 text-center flex-1 flex flex-col justify-center">
                                    {/* å€’è®¡æ—¶æ˜¾ç¤º */}
                                    {gameState === 'testing' && (
                                        <div className="mb-8">
                                            <div className="countdown-circle w-32 h-32 rounded-full mx-auto mb-4 flex items-center justify-center">
                                                <div className="bg-black w-28 h-28 rounded-full flex items-center justify-center">
                                                    <span className="text-4xl font-black text-white">
                                                        {Math.ceil(timeLeft)}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* ä¸»è¦æ•°æ®æ˜¾ç¤º */}
                                    <div className="space-y-6">
                                        <div>
                                            <div className="text-cyan-300 text-2xl mb-2">å½“å‰ CPS</div>
                                            <div className="text-8xl font-black text-white neon-glow">
                                                {currentCPS.toFixed(1)}
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-8">
                                            <div>
                                                <div className="text-purple-300 text-xl mb-2">ç‚¹å‡»æ¬¡æ•°</div>
                                                <div className="text-4xl font-bold text-white">
                                                    {clickCount}
                                                </div>
                                            </div>
                                            <div>
                                                <div className="text-pink-300 text-xl mb-2">å‰©ä½™æ—¶é—´</div>
                                                <div className="text-4xl font-bold text-white">
                                                    {gameState === 'testing' ? `${timeLeft.toFixed(1)}s` : `${duration}s`}
                                                </div>
                                            </div>
                                        </div>

                                        {/* ç­‰çº§æ˜¾ç¤º */}
                                        <div className="mt-8">
                                            <div className="flex items-center justify-center space-x-4">
                                                <span className="text-4xl">{levelInfo.icon}</span>
                                                <span className="level-badge text-3xl font-black">
                                                    {levelInfo.name}
                                                </span>
                                            </div>
                                        </div>

                                        {/* çŠ¶æ€æ–‡æœ¬ */}
                                        <div className="mt-8">
                                            <div className={`text-2xl font-bold ${
                                                gameState === 'testing' ? 'text-yellow-300 pulse-animation' : 'text-cyan-300'
                                            }`}>
                                                {getStatusText()}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* æœ€ä½³æˆç»©æ˜¾ç¤º */}
                                <div className="stats-card p-6 text-center">
                                    <div className="text-yellow-300 text-lg mb-2">ä¸ªäººæœ€ä½³</div>
                                    <div className="text-3xl font-black text-white neon-glow">
                                        {bestCPS.toFixed(1)} CPS
                                    </div>
                                    <div className="text-sm text-gray-300 mt-1">
                                        {getLevelInfo(bestCPS).icon} {getLevelInfo(bestCPS).name}
                                    </div>
                                </div>
                            </div>

                            {/* å†å²è®°å½•ä¾§æ  */}
                            <div className="w-80">
                                <div className="data-display rounded-2xl p-6 h-full">
                                    <h3 className="text-white text-xl mb-4 text-center neon-glow">
                                        æµ‹è¯•å†å²
                                    </h3>
                                    <div className="space-y-3 overflow-y-auto max-h-96">
                                        {history.length === 0 ? (
                                            <div className="text-gray-400 text-center py-8">
                                                è¿˜æ²¡æœ‰æµ‹è¯•è®°å½•
                                            </div>
                                        ) : (
                                            history.map((record, index) => (
                                                <div
                                                    key={record.timestamp}
                                                    className={`history-item p-4 rounded-lg ${
                                                        index === 0 ? 'latest' : ''
                                                    }`}
                                                >
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div className="text-cyan-300 font-bold text-lg">
                                                            {record.cps.toFixed(1)} CPS
                                                        </div>
                                                        <div className="text-xs text-gray-300">
                                                            {new Date(record.timestamp).toLocaleTimeString()}
                                                        </div>
                                                    </div>
                                                    <div className="flex justify-between items-center text-sm">
                                                        <span className="text-white">
                                                            {record.clicks} æ¬¡ç‚¹å‡»
                                                        </span>
                                                        <span className="text-purple-300">
                                                            {record.duration}s
                                                        </span>
                                                    </div>
                                                    <div className="mt-2 flex items-center space-x-2">
                                                        <span>{getLevelInfo(record.cps).icon}</span>
                                                        <span 
                                                            className="text-sm font-bold"
                                                            style={{ color: getLevelInfo(record.cps).color }}
                                                        >
                                                            {record.level}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                    
                                    {/* æ¸…é™¤å†å²æŒ‰é’® */}
                                    {history.length > 0 && (
                                        <button
                                            className="w-full mt-4 glow-button text-white py-2 px-4 rounded-lg text-sm"
                                            onClick={() => {
                                                setHistory([]);
                                                localStorage.removeItem('cps-history');
                                            }}
                                        >
                                            æ¸…é™¤å†å²
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* æ“ä½œæç¤º */}
                        <div className="text-center mt-6">
                            <div className="text-gray-300 text-sm">
                                ğŸ® æŒ‰ç©ºæ ¼é”®å¼€å§‹/ç‚¹å‡» | ğŸ”¢ æ•°å­—é”®1-4é€‰æ‹©æ—¶é•¿ | âš¡ ç–¯ç‹‚æŒ‰ç©ºæ ¼é”®è·å¾—é«˜åˆ†
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<CPSTester />, document.getElementById('root'));
    </script>
</body>
</html>